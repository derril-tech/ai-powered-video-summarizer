# Created automatically by Cursor AI (2024-12-19)
apiVersion: 1

providers:
  - name: 'SLO Dashboards'
    orgId: 1
    folder: 'SLOs'
    type: file
    disableDeletion: false
    updateIntervalSeconds: 10
    allowUiUpdates: true
    options:
      path: /var/lib/grafana/dashboards

dashboards:
  - name: 'Video Processing SLOs'
    uid: video-processing-slos
    title: 'Video Processing SLOs'
    tags: ['slo', 'video-processing', 'production']
    timezone: 'browser'
    refresh: '30s'
    schemaVersion: 38
    version: 1
    links: []
    panels:
      # Error Budget Panel
      - id: 1
        title: 'Error Budget Remaining'
        type: 'stat'
        targets:
          - expr: |
              (
                sum(rate(video_processing_success_total[24h])) 
                / 
                sum(rate(video_processing_total[24h]))
              ) * 100
            legendFormat: 'Success Rate %'
        fieldConfig:
          defaults:
            color:
              mode: 'thresholds'
            thresholds:
              steps:
                - color: 'red'
                  value: null
                - color: 'orange'
                  value: 95
                - color: 'green'
                  value: 99
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 0
          y: 0

      # Processing Time SLO
      - id: 2
        title: 'Video Processing Time (95th percentile)'
        type: 'timeseries'
        targets:
          - expr: |
              histogram_quantile(0.95, 
                sum(rate(video_processing_duration_seconds_bucket[5m])) by (le)
              )
            legendFormat: '95th percentile'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 's'
        gridPos:
          h: 8
          w: 12
          x: 12
          y: 0

      # Success Rate Panel
      - id: 3
        title: 'Video Processing Success Rate'
        type: 'timeseries'
        targets:
          - expr: |
              sum(rate(video_processing_success_total[5m])) 
              / 
              sum(rate(video_processing_total[5m])) * 100
            legendFormat: 'Success Rate %'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 0
          y: 8

      # Queue Depth Panel
      - id: 4
        title: 'Processing Queue Depth'
        type: 'timeseries'
        targets:
          - expr: |
              sum(video_processing_queue_depth)
            legendFormat: 'Queue Depth'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
        gridPos:
          h: 8
          w: 12
          x: 12
          y: 8

      # Error Rate by Type
      - id: 5
        title: 'Error Rate by Type'
        type: 'timeseries'
        targets:
          - expr: |
              sum(rate(video_processing_errors_total[5m])) by (error_type)
            legendFormat: '{{error_type}}'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
        gridPos:
          h: 8
          w: 24
          x: 0
          y: 16

  - name: 'API Gateway SLOs'
    uid: api-gateway-slos
    title: 'API Gateway SLOs'
    tags: ['slo', 'api-gateway', 'production']
    timezone: 'browser'
    refresh: '30s'
    schemaVersion: 38
    version: 1
    links: []
    panels:
      # Response Time SLO
      - id: 1
        title: 'API Response Time (95th percentile)'
        type: 'timeseries'
        targets:
          - expr: |
              histogram_quantile(0.95, 
                sum(rate(http_request_duration_seconds_bucket[5m])) by (le, endpoint)
              )
            legendFormat: '{{endpoint}}'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 's'
        gridPos:
          h: 8
          w: 12
          x: 0
          y: 0

      # Error Rate SLO
      - id: 2
        title: 'API Error Rate'
        type: 'timeseries'
        targets:
          - expr: |
              sum(rate(http_requests_total{status=~"5.."}[5m])) 
              / 
              sum(rate(http_requests_total[5m])) * 100
            legendFormat: '5xx Error Rate %'
        fieldConfig:
          defaults:
            color:
              mode: 'thresholds'
            thresholds:
              steps:
                - color: 'green'
                  value: null
                - color: 'orange'
                  value: 1
                - color: 'red'
                  value: 5
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 12
          y: 0

      # Request Rate
      - id: 3
        title: 'Request Rate'
        type: 'timeseries'
        targets:
          - expr: |
              sum(rate(http_requests_total[5m])) by (endpoint)
            legendFormat: '{{endpoint}}'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'reqps'
        gridPos:
          h: 8
          w: 12
          x: 0
          y: 8

      # Authentication Success Rate
      - id: 4
        title: 'Authentication Success Rate'
        type: 'timeseries'
        targets:
          - expr: |
              sum(rate(auth_success_total[5m])) 
              / 
              sum(rate(auth_attempts_total[5m])) * 100
            legendFormat: 'Success Rate %'
        fieldConfig:
          defaults:
            color:
              mode: 'thresholds'
            thresholds:
              steps:
                - color: 'red'
                  value: null
                - color: 'orange'
                  value: 95
                - color: 'green'
                  value: 99
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 12
          y: 8

  - name: 'Infrastructure SLOs'
    uid: infrastructure-slos
    title: 'Infrastructure SLOs'
    tags: ['slo', 'infrastructure', 'production']
    timezone: 'browser'
    refresh: '30s'
    schemaVersion: 38
    version: 1
    links: []
    panels:
      # Database Connection Pool
      - id: 1
        title: 'Database Connection Pool'
        type: 'timeseries'
        targets:
          - expr: |
              sum(db_connections_active) by (instance)
            legendFormat: '{{instance}} - Active'
          - expr: |
              sum(db_connections_idle) by (instance)
            legendFormat: '{{instance}} - Idle'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
        gridPos:
          h: 8
          w: 12
          x: 0
          y: 0

      # Redis Memory Usage
      - id: 2
        title: 'Redis Memory Usage'
        type: 'timeseries'
        targets:
          - expr: |
              redis_memory_used_bytes / redis_memory_max_bytes * 100
            legendFormat: 'Memory Usage %'
        fieldConfig:
          defaults:
            color:
              mode: 'thresholds'
            thresholds:
              steps:
                - color: 'green'
                  value: null
                - color: 'orange'
                  value: 70
                - color: 'red'
                  value: 90
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 12
          y: 0

      # GPU Utilization
      - id: 3
        title: 'GPU Utilization'
        type: 'timeseries'
        targets:
          - expr: |
              nvidia_gpu_utilization{job="gpu-workers"}
            legendFormat: 'GPU {{gpu}}'
        fieldConfig:
          defaults:
            color:
              mode: 'palette-classic'
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 0
          y: 8

      # Storage Usage
      - id: 4
        title: 'Storage Usage'
        type: 'timeseries'
        targets:
          - expr: |
              (node_filesystem_size_bytes - node_filesystem_avail_bytes) 
              / node_filesystem_size_bytes * 100
            legendFormat: '{{instance}} - {{mountpoint}}'
        fieldConfig:
          defaults:
            color:
              mode: 'thresholds'
            thresholds:
              steps:
                - color: 'green'
                  value: null
                - color: 'orange'
                  value: 80
                - color: 'red'
                  value: 90
            custom:
              fillOpacity: 10
              lineWidth: 2
            unit: 'percent'
            decimals: 2
        gridPos:
          h: 8
          w: 12
          x: 12
          y: 8
